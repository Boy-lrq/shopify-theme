<!doctype html>
<html lang="{{ shop.locale }}">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ page_title }}</title>
    <style>
      /* 基础样式 */
      body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          margin: 0;
          min-height: 100vh;
          background: #f0f0f0;
      }

      /* 弹窗背景 */
      .popup-background {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.3);
          backdrop-filter: blur(10px);
          display: none;
          justify-content: center;
          align-items: center;
          z-index: 9999;
      }

      /* 弹窗主体 */
      .popup-card {
          background: white;
          border-radius: 14px;
          padding: 2rem;
          max-width: 500px;
          width: 90%;
          position: relative;
          box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      }

      /* 关闭按钮 */
      .close-btn {
          position: absolute;
          top: 1rem;
          right: 1rem;
          background: none;
          border: none;
          cursor: pointer;
          color: #666;
          /* 增大字体大小 */
          font-size: 24px;
          /* 调整内边距以增大点击区域 */
          padding: 5px;
      }

      /* 图片区域 */
      .coupon-image {
          position: relative;
          height: 200px;
          border-radius: 8px;
          overflow: hidden;
          margin-bottom: 1.5rem;
      }

      .coupon-image img {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }

      .coupon-sprite {
          /* 设置精灵图为背景图像 */
          background-image: url('https://gw.alicdn.com/imgextra/i1/O1CN01Lz3PB11Hq72toc39W_!!6000000000808-1-tps-960-288.gif');
          /* 设置背景图像的大小，确保整个精灵图都能显示 */
          background-size: cover;
          /* 设置背景图像的位置，这里假设你要显示的部分从左上角开始 */
          background-position: 0 0;
          /* 设置元素的宽度和高度，根据你要显示的图像部分调整 */
          width: 100%;
          height: 100%;
      }

      .coupon-sprite {
          background-position: 235px 200px;
          /* 根据实际情况调整偏移量 */
      }

      /* 优惠券标签 */
      .coupon-tag {
          position: absolute;
          bottom: 0;
          left: 0;
          background: linear-gradient(to right, #ec4899, #ef4444);
          color: white;
          padding: 0.5rem 1rem;
          font-size: 0.875rem;
          font-weight: bold;
      }

      /* 主要内容 */
      .content {
          text-align: center;
      }

      .discount-text {
          font-size: 2rem;
          font-weight: 800;
          color: #1f2937;
          margin: 1rem 0;
      }

      /* 倒计时 */
      .countdown {
          background: #f3f4f6;
          padding: 0.5rem 1rem;
          border-radius: 8px;
          display: inline-block;
          margin: 1rem 0;
      }

      /* 领取按钮 */
      .claim-btn {
          width: 100%;
          background: linear-gradient(to right, #ec4899, #ef4444);
          color: white;
          padding: 1rem;
          border: none;
          border-radius: 12px;
          font-size: 1.125rem;
          font-weight: bold;
          cursor: pointer;
          margin-top: 1.5rem;
          transition: transform 0.2s, box-shadow 0.2s;
      }

      .claim-btn:hover {
          transform: scale(1.02);
          box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }
    </style>
  </head>

  <body>
    <!-- 弹窗结构 -->
    <div class="popup-background" id="popup">
      <div class="popup-card">
        <button class="close-btn" onclick="closePopup()">×</button>
        <div class="coupon-image">
          <!-- 修改为一个空的div，用于显示精灵图的部分 -->
          <div class="coupon-sprite"></div>
          <div class="coupon-tag">LIMITED OFFER</div>
        </div>
        <div class="content">
          <h3 class="discount-text">7折优惠券</h3>
          <p>限时专享优惠，立即领取！</p>
          <div class="countdown">剩余时间: <span id="countdown">23:59:59</span></div>
          <p>🛒 满100元可用</p>
          <p>📅 有效期至12/31</p>
          <button class="claim-btn" onclick="claimCoupon()">🎉 立即领取（剩余5张）</button>
        </div>
      </div>
    </div>

    <script>
        // 确保DOM加载完成
        document.addEventListener('DOMContentLoaded', function () {
            const popup = document.getElementById('popup');
            let hasTriggered = false;

            // 倒计时功能
            let remainingTime = 24 * 60 * 60;
            function updateCountdown() {
                const hours = Math.floor(remainingTime / 3600);
                const minutes = Math.floor((remainingTime % 3600) / 60);
                const seconds = remainingTime % 60;
                document.getElementById('countdown').textContent =
                    `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                if (remainingTime > 0) remainingTime--;
            }
            setInterval(updateCountdown, 1000);

            // 显示弹窗逻辑
            function checkTrigger(e) {
                if (hasTriggered) return;
                if (e.clientY <= 20) showPopup();
            }

            // 暴露全局方法
            window.showPopup = function () {
                popup.style.display = 'flex';
                hasTriggered = true;
            }

            window.closePopup = function () {
                popup.style.display = 'none';
            }

            window.claimCoupon = function () {
                alert('优惠券已领取！');
                closePopup();
            }

            // 事件监听
            document.addEventListener('mouseleave', checkTrigger);

            // 初始化演示（正式使用应移除）
            setTimeout(showPopup, 1000);
        });
    </script>

    {{ content_for_layout }}
  </body>
</html>
